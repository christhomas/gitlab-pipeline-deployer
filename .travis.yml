sudo: required

services:
  - docker

language: generic

env:
  global:
  - secure: "BtrqkAkA0NGgAhj5l7Lcaf9O/elVJv/1oJLVig9JyBDjh7SvH+vj/3Tbfnw6P0amPcipYdvvrHvaPSgRkIk8i2tJhI2tr7ZC/Us/9nGcgS9LP2mtvr7XJO1TN8+hma44hE3H3WU9CbWpMLQNRFnv+3ZThY7vB2cvTyMeqniawV5m9BeRSd9ZNGN4XGwtI+6fDpDQzSR9V72AzQDbWY10m3p9/Zh9I6oQZ+fYIpBDmWb89L6O0HOVYM64JZ5R5mw9nmBww8Hnhf9MQE9Ej34nSk7u5SAJm3ir92s4f7G64W9Xn9atGxcPKSWgBpWePNHJvrMSpjgFOsox+eI1UIx1uXqCO4MS82Vta0/cVxuhN2XQHPImadn1cdZA1j1ksOuWGhao/80AbD/EqnXvZJoLiVZJJ4QO8xSGSMNzUjQ0t+bFrUKTOz5S+vU4qy6yRINA5FEKCIK3wprlA/eO98EEsTUft5K56FQXvinoVudVzBmQi9QJL9MgZ3HxGbzIj4VfS0RPmADSl8+jolaixS9Z4JBO1wAbSWSL+36pChVJIyEAA5fuegEvQRCaA/5YFXZPjUQMPYdi0/miGF7kr4/T2jfcIvqzBX2xtPzUFbQDKrEKhGSuVe1D6QScaJn6w/FpyjGPfqMT7JLQUJk9fWOyD16JIPwDsrqbast6gCR+Z1c="
  - secure: "dxg1Mk+6+Xl63a5/N3eJnYBNYLEI82jbRbplR8wyZijKLaGK4qLdeFTdc1UMyISGDfWi3gsy0ZEftNIkIt6GagkWvBI/6iYoyoLiCcGPOtBwEXUcxzirud3fSvDjf5ioV2CMmiamfmFj5ErXvbFH6w9N5RZDGaYAM6VqRhwlpphreu3boA3slwdqVVUyj+ijJm73/n1mYYFHVpMfJZo6qn6oHzlni6kAY5zXzkKo7TegYQIHCKgjN4+VZyGX9ln7XTsihTc1VNln0NqbsLPcDst1H+ZIJufZYGX/QLeAkmx9h+eQ38MB7nMwfns7QlImfElk4DSFk/iSUuxebLK/FW32Mk9oqC5VAkiOagGETJz398sCB+VMpbThMaBsEjnXCHgt7Au1HXvpzncYQr848HH3l9fFiMJHDngnSnGkqK9FqVD0wS7JcpOZ49ShwO/A6OulPY44m4lfanmW+HLHL+fB+I8l73gqsUcOdWBl3PC4CLn6MsuaMwuLNYiQr8JjKS//GuFdE4VNgYKQ/dKIxWZEFSDOdtNHxDsBmxTj+/sXBhvD/QemWHugZmdUi2l03lDTgKaDELMvaHca/oJKn3Uby/Dk/p8LTAm8pwXNgvxgU+NKVTw2GgyKvTRwZU1mjmJZtxvH7oVgw1vjAMUsBoE1NIFhFH76zUxPnEuEeSs="

before_install:
- VAR1=${DOCKERHUB_USERNAME}; echo $VAR1; env
- TAG=$(time=$(date +%T) && echo "$(date +%F)_${time//:/.}")
- IMAGE=pipeline-deployer
- echo "Building image '${IMAGE}:${TAG}'"
- docker build --pull -t ${IMAGE}:${TAG} .
- if [ "${TRAVIS_BRANCH}" = "master" ]; then docker tag ${IMAGE}:${TAG} ${IMAGE}:latest;
  fi

script:
- echo "Searching for image '${IMAGE}:(any tag)'"
- docker images ${IMAGE}

after_success:
- if [ "${TRAVIS_PULL_REQUEST}" != "false" ]; then exit 0; fi
- docker login -u ${DOCKERHUB_USERNAME} -p ${DOCKERHUB_PASSWORD};
- if [ "${TRAVIS_BRANCH}" = "master" ]; then docker push ${IMAGE}:latest; fi
- docker push ${IMAGE}:${TAG};
