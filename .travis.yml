sudo: required

services:
  - docker

language: generic

env:
  global:
  - secure: "a3I0nRTXCJ3TGcK4ZTvdD5sdKs5XDUJ0bngNR5wDiPt/xAHVZDSmL6MHEaiaEe2pI3AOiXjTdnd736aB7UgFOqb1NbRWNMfM8LWW6bIjhnlmdfYNxUlRiy1m2Jy7CUYw2xINXN3hVSYttmjRI1NhKaY4mv3LBfE3ZjOplBJbNiAGM/54A0CSrdfjSAIUjT8u+88t1nHbbGVz4utvRcumQLJWgyG7QBw4MMfQPkjsSpbaILbFaPTJfh15tC5ho+vRwPefG84v0i7PvXetG+hbyWtoxLRgDCusrBJXeMXu46U7lm8Emms1Q5TSrM6wUDEAniO2niC+oJALhCvE2RlDtjaCj/QCnBefCJvAfvNWeWuUDV6LcJjS65rmb2py5biEfjJJb3itB+nsc1P+xpau6gmlV3VqwtY37/53eraRLOIESO7tKlDWQCKGESg2E/SEmXkHTNA/axSNIahTkT8+wNCQkpUiHGX11IGIduC0WD5YRkJdr9Rh55LkIGWrSzmTm0D6tVr+cM/kLILggIuJ69v8f0M7Nt0feGtz5ITsSV4gQEYXMyeHV+DN49uc3S8VFMfWQKtVIiL7m/MNgJArRDA3rTO7ZJ514+y7uKeNJiYG8CaiD4bSebtxqC7VtV5eaQ6eaDcpFF2vT0+ppfBdhkSGyo0sky15G4PwHch7PCI="
  - secure: "gHTed23dbpXsQhQLtZFVKKaUsNv9YFVZcnGm6uXRm8ekkDldu8JPtR6iWs+TDkZ6zVa54F0ftyETelP5F8sibfLDtiGkBPmdf7Vly2wFS4AdO7qCBCZyLflbCHYyMybRU/bUR03GBcNjuU85Z4kFhAno//zgOZ30CSDyiWJlHWfg+RmexluHEElJAEp2IrXQ2kWIGBqcC7ePe2doFcwGPD8vEJezPFgBZ/mrZsuUbmOW6ujCCIQYM5sC6gymjIeQ40FfBEtEM3a9IrN4S1b/eFme4M0AaREs2phR4AmD71wNFnhr9NHcZOtKefZNDGMtx7GNAFWZWURgK5YCSsOAX7o/Z7mX4m1rBSNYlwlDrg8VGXvHt6ag0+cys+hE5NsK2vuCC9iZfpnd1ZUm2kZukk3R/seDPALx7mIdR2qqMr3wtJqio7U7s6jzMKQF5+J2FPOEH+5VHRMe8SyOUA9xCJ6R0rd9HhQnTT/OzMC72dFILcJ0mzB5wUqNlQCzj6WOSik1mqJDL/altqC9gER0t0jdtinuzw/DEVH64HBpBptIZbadmMyJfbp4ESztdIpQRK5rHVTc3RvRxPQvHNVosZDlnpswZtxJk/YMx9Gier5Wy+1OOme46rq09+G+9Lm7rtxWSMhDFOV1lyfadK7ewFjeFc+YKd7nT4x7NneIXaA="

before_install:
- VAR1=${DOCKERHUB_USERNAME}; echo $VAR1; env
- TAG=$(time=$(date +%T) && echo "$(date +%F)_${time//:/.}")
- IMAGE=pipeline-deployer
- echo "Building image '${IMAGE}:${TAG}'"
- docker build --pull -t ${IMAGE}:${TAG} .
- if [ "${TRAVIS_BRANCH}" = "master" ]; then docker tag ${IMAGE}:${TAG} ${IMAGE}:latest;
  fi

script:
- echo "Searching for image '${IMAGE}:(any tag)'"
- docker images ${IMAGE}

after_success:
- if [ "${TRAVIS_PULL_REQUEST}" != "false" ]; then exit 0; fi
- docker login -u ${DOCKERHUB_USERNAME} -p ${DOCKERHUB_PASSWORD};
- if [ "${TRAVIS_BRANCH}" = "master" ]; then docker push ${IMAGE}:latest; fi
- docker push ${IMAGE}:${TAG};
