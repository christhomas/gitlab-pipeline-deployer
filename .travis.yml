sudo: required

services:
  - docker

language: generic

env:
  DOCKERHUB_USERNAME:
    secure: "HYDHzSIeePKCEyhyLklSstntVNzkaHVMS640OVb23+bd7e1spLFj5J8iq451MIa5VS+6Ob3umJd7CTuslBSp64KvToOyh6mjDe6sUmN/I1o1iCTESdKsTBPf+Z1wASY2gyV9DhtMbVQaFTvY7dZFXBI9pBRdYV1d1v56om4CLq5MzFCxd6GmozZPgiQjdStpuc075CyCsDloSvWLfV+6vVg3BfbNFljKVdVvF14vxvr7/XeUAxNOS94j4OwdQ4JoI8/PgbPXvFGIUGE1XNssHqD/tMatFW0ePj/oxQ3FsCTya++b4o8hLQouYGHnboABpvMFYxiCjc3aYOIY7Xg4Xk3yar2kVxgUIxw0e0h7XZZun13y4qyqAHFkP2PR3LSQnVCH0xm+28N/D2/l1Rw/nFtM8dL1l+3hteJk5kS0GxKDPZc6ZAnN9g9fNa1pjQSOOIC9644UIskYkVJ0bAXNIuDp0kMouZtqx9a+pZTbM/KZ2G0G0SAvlV/0hELlKoIoACtwrxY+0TB7DJs3JAC2gVXOCr8vBGbxV0szkR9RYAJXZ979GCQ36ZJiJkl5kZORHCAj6uAqoR+kweJtGRGnqhlBIEiDtp7Y080snEQXlnsRN/ajVhiJdzQ0Y3v2n1qDGzlYy1xu2jIG9mJ/IzMHv5YXRp8UcWbi4TSAESpmx+M="
  DOCKERHUB_PASSWORD:
    secure: "MS0PLwC5CGEOytYkBfHycoqD+wY/ZBwW3ufoSMXvpOzFkoDRT/DtKTGrGLQ/k2krdHrhw+6Pyu5lqQ3sd24eT3KQdf1Mj4/q/hqQDh7d0im5YuLZMqy/Bq8osVUGu+hVvaNGgqyDRMRmwSiE8nQy1j6oO+4vupk5KcGiCiJHvlH6p6oQzlwsudYL4JFAt7r/6qKjuTJIk38KE+TLimHwV8INcKZAbctL6K6u7ZjA8uZ/7zNZax//vRHafZuow6XQX22g0iAWmccDb7z8RqBaWxAuJq1Rpgm32Li9i2ikT3MVTDZcjQSLzh85xcatSzm49YC0/1G1Ddke1bBIQ9i1TNkmJISyko0WyZV/nbqIBeBbRu0yAd14K4b6F0lidz3gTG2UPT7ZZB6+/+Zp/1IdU1KcOfGQJYKS8D6XPZ/WWD/lKKb0cXm3QhPFN+2tJjpBM61UO/vFwdcdMN47PEDA4KzcVNcBX6gP35ZWZAZP42z4qg7MdaEfqds0xfW6Bv0PqGt5FYhg8oje84tNX7z6cLjenL/mIqWRFYVX3K5p48UezIvzq37fcCTfEjBeI3Yb1meXXKfHRPAYe5IGrbqQChsVdmloPVSrXQ7jMPdHBqw14NXUAsNniPuOOFhSHhzCRxdPulni5G2RtLlbPj0i1H+Z5TWdg1Fg5gjoy+Qvjms="

before_install:
- VAR1=${DOCKERHUB_USERNAME}; echo $VAR1; env
- TAG=$(time=$(date +%T) && echo "$(date +%F)_${time//:/.}")
- IMAGE=pipeline-deployer
- echo "Building image '${IMAGE}:${TAG}'"
- docker build --pull -t ${IMAGE}:${TAG} .
- if [ "${TRAVIS_BRANCH}" = "master" ]; then docker tag ${IMAGE}:${TAG} ${IMAGE}:latest;
  fi

script:
- echo "Searching for image '${IMAGE}:(any tag)'"
- docker images ${IMAGE}

after_success:
- if [ "${TRAVIS_PULL_REQUEST}" != "false" ]; then exit 0; fi
- docker login -u ${DOCKERHUB_USERNAME} -p ${DOCKERHUB_PASSWORD};
- if [ "${TRAVIS_BRANCH}" = "master" ]; then docker push ${IMAGE}:latest; fi
- docker push ${IMAGE}:${TAG};
